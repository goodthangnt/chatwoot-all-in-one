FROM node:22.16.0-alpine as builder

ENV PORT=21465

RUN apk add --no-cache git wget

WORKDIR /home/node
RUN git clone https://github.com/wppconnect-team/wppconnect-server.git /home/node/app 

WORKDIR /home/node/app

COPY ./config.json /home/node/app/src

RUN yarn install
RUN yarn build

FROM node:22.16.0-alpine
ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true
WORKDIR /home/node/app
RUN apk add --no-cache chromium
COPY --from=builder /home/node/app/ .
EXPOSE 21465

ENTRYPOINT ["yarn", "start"]
